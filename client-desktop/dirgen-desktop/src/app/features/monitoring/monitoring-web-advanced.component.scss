// MonitoringWebAdvanced - Interfaz completa para navegador web con CSS Grid
.monitoring-grid-container {
  display: grid;
  // Define las filas: una fila pequeña para las etapas, y una fila que ocupa el resto del espacio
  grid-template-rows: auto 1fr auto; // StatusBar + Main Content + Footer
  height: 100vh; // Altura total de la ventana
  width: 100vw;
  background: #1a1a1a;
  color: #e0e0e0;
  overflow: hidden;
  position: relative;

  // ===============================
  // STATUSBAR AVANZADO
  // ===============================
  .status-bar-section {
    flex-shrink: 0;
    z-index: 100;
  }

  // ===============================
  // MENSAJE DE BIENVENIDA
  // ===============================
  .welcome-banner {
    position: absolute;
    top: 90px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 1000;
    animation: slideDown 0.5s ease-out;
    
    .welcome-content {
      background: linear-gradient(135deg, #27ae60, #2ecc71);
      color: white;
      padding: 12px 24px;
      border-radius: 25px;
      display: flex;
      align-items: center;
      gap: 12px;
      box-shadow: 0 8px 32px rgba(39, 174, 96, 0.4);
      backdrop-filter: blur(10px);
      
      .welcome-icon {
        font-size: 24px;
        animation: bounce 2s infinite;
      }
      
      .welcome-text {
        font-weight: 500;
        font-size: 14px;
      }
      
      .close-welcome {
        color: white !important;
        width: 32px !important;
        height: 32px !important;
        
        mat-icon {
          font-size: 18px !important;
        }
      }
    }
  }

  // ===============================
  // CONTENEDOR DE PANELES PRINCIPALES
  // ===============================
  .main-panels-container {
    display: grid;
    // Define las columnas: una para el panel izquierdo y otra para el derecho
    grid-template-columns: 35% 1fr; // Izquierda 35%, derecha resto
    overflow: hidden; // Previene desbordamientos en los paneles
    position: relative;
    width: 100%;
    height: 100%;
    
    // Panel izquierdo optimizado para CSS Grid
    .left-panel {
      width: 100%; // Gestionado por CSS Grid
      min-width: 420px;
      background: linear-gradient(180deg, #2c2c2c, #252525);
      border-right: 3px solid #3498db;
      display: flex;
      flex-direction: column;
      padding: 20px;
      gap: 20px;
      overflow-y: auto;
      position: relative;
      height: 100%; // Ocupa toda la altura disponible del grid
      
      // Efecto de gradiente en el borde
      &::after {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        width: 3px;
        height: 100%;
        background: linear-gradient(180deg, #3498db, #2980b9, #3498db);
        animation: borderGlow 3s infinite;
      }

      .control-section {
        flex-shrink: 0;
        background: rgba(52, 152, 219, 0.1);
        border-radius: 12px;
        border: 1px solid rgba(52, 152, 219, 0.3);
        padding: 16px;
        box-shadow: 0 8px 32px rgba(52, 152, 219, 0.2);
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
        
        &:hover {
          transform: translateY(-2px);
          box-shadow: 0 12px 48px rgba(52, 152, 219, 0.3);
          border-color: rgba(52, 152, 219, 0.5);
        }
        
        .project-control-component {
          display: block;
        }
      }

      .plan-section {
        flex: 1;
        background: rgba(230, 126, 34, 0.1);
        border-radius: 12px;
        border: 1px solid rgba(230, 126, 34, 0.3);
        padding: 16px;
        box-shadow: 0 8px 32px rgba(230, 126, 34, 0.2);
        backdrop-filter: blur(10px);
        min-height: 300px;
        transition: all 0.3s ease;
        
        &:hover {
          transform: translateY(-2px);
          box-shadow: 0 12px 48px rgba(230, 126, 34, 0.3);
          border-color: rgba(230, 126, 34, 0.5);
        }
        
        .plan-widget-component {
          height: 100%;
          display: block;
        }
      }
    }

    // Panel derecho con sub-grid de filas (LA PARTE CLAVE)
    .right-panel-grid {
      display: grid;
      // Define las filas: el log ocupa todo el espacio posible, el centro de mando un tamaño fijo
      grid-template-rows: 1fr auto; // Log flexible + Centro de Mando fijo
      height: 100%; // Ocupa toda la altura disponible del grid padre
      overflow: hidden; // Previene desbordamientos
      background: linear-gradient(180deg, #1e1e1e, #1a1a1a);
      position: relative;
      
      // Event Log - Ocupa la fila flexible del grid
      .event-log-component {
        overflow-y: auto; // Scroll dentro del log (CRITICAL)
        overflow-x: hidden;
        min-height: 0; // Permite que el área del log se encoja en grid
        padding: 20px;
        background: rgba(39, 174, 96, 0.1);
        border-radius: 12px;
        margin: 20px;
        border: 1px solid rgba(39, 174, 96, 0.3);
        box-shadow: 0 8px 32px rgba(39, 174, 96, 0.2);
        backdrop-filter: blur(10px);
        position: relative;
        transition: all 0.3s ease;
        width: calc(100% - 40px); // Ajuste para los márgenes
        
        &:hover {
          border-color: rgba(39, 174, 96, 0.5);
          box-shadow: 0 12px 48px rgba(39, 174, 96, 0.3);
        }
        
        // Efecto de resplandor en la esquina
        &::before {
          content: '';
          position: absolute;
          top: -2px;
          right: -2px;
          width: 20px;
          height: 20px;
          background: radial-gradient(circle, #27ae60, transparent);
          border-radius: 50%;
          animation: cornerGlow 2s infinite alternate;
        }
        
        // Asegurar que el componente llene el contenedor
        app-event-log {
          height: 100%;
          display: block;
          width: 100%;
        }
      }

      // Command Center - Ocupa la fila fija del grid
      app-command-center {
        /* Fila fija del grid: tamaño automático por contenido */
        min-height: 120px;
        max-height: 200px;
        padding: 0 20px 20px 20px;
        overflow: hidden; // CRITICAL: Prevent horizontal overflow
        display: block;
        width: 100%;
        box-sizing: border-box;
        
        // Estilos profundos para asegurar control total del overflow
        ::ng-deep {
          .command-center {
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
            overflow: hidden;
          }

          .input-container {
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
            overflow: hidden;
            
            .prompt-input {
              width: 100%;
              max-width: 100%;
              
              .mat-mdc-form-field {
                width: 100%;
                max-width: 100%;
                
                .mdc-text-field,
                .mat-mdc-form-field-flex {
                  width: 100%;
                  max-width: 100%;
                  min-width: 0; // Critical for preventing overflow
                }
                
                .mat-mdc-form-field-infix {
                  width: 100%;
                  min-width: 0; // Critical for flex shrinking
                  
                  input {
                    width: 100%;
                    min-width: 0;
                  }
                }
              }
            }
          }

          // Chips styling to prevent overflow
          .attached-files {
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
            overflow: hidden;
            
            mat-chip-set {
              max-width: 100%;
              
              mat-chip {
                max-width: 100%;
                
                .mat-mdc-chip-action-label {
                  max-width: 200px;
                  overflow: hidden;
                  text-overflow: ellipsis;
                  white-space: nowrap;
                }
              }
            }
          }
        }
      }
    }
  }

  // ===============================
  // STATUSFOOTER AVANZADO
  // ===============================
  .status-footer-section {
    flex-shrink: 0;
    z-index: 100;
  }
}

// ===============================
// INDICADORES FLOTANTES
// ===============================
.floating-indicators {
  position: fixed;
  top: 50%;
  right: 24px;
  transform: translateY(-50%);
  z-index: 999;
  
  .analysis-indicator {
    background: linear-gradient(135deg, #f39c12, #e67e22);
    color: white;
    padding: 16px 20px;
    border-radius: 30px;
    display: flex;
    align-items: center;
    gap: 12px;
    box-shadow: 0 8px 32px rgba(243, 156, 18, 0.4);
    animation: floatIndicator 3s infinite ease-in-out;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    
    mat-icon {
      font-size: 24px;
      
      &.spinning {
        animation: spin 2s linear infinite;
      }
    }
    
    span {
      font-weight: 500;
      font-size: 14px;
    }
  }
}

// ===============================
// EFECTOS VISUALES AVANZADOS
// ===============================

// Partículas de fondo animadas
.monitoring-grid-container::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-image: 
    radial-gradient(circle at 20% 30%, rgba(52, 152, 219, 0.1) 0%, transparent 50%),
    radial-gradient(circle at 80% 70%, rgba(39, 174, 96, 0.1) 0%, transparent 50%),
    radial-gradient(circle at 40% 80%, rgba(230, 126, 34, 0.1) 0%, transparent 50%);
  animation: particleFloat 20s infinite linear;
  pointer-events: none;
  z-index: 1;
}

// Grid de fondo sutil
.monitoring-grid-container::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-image: 
    linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px),
    linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px);
  background-size: 50px 50px;
  pointer-events: none;
  z-index: 1;
}

// ===============================
// ANIMACIONES
// ===============================
@keyframes slideDown {
  0% {
    transform: translate(-50%, -100px);
    opacity: 0;
  }
  100% {
    transform: translate(-50%, 0);
    opacity: 1;
  }
}

@keyframes bounce {
  0%, 20%, 50%, 80%, 100% {
    transform: translateY(0);
  }
  40% {
    transform: translateY(-10px);
  }
  60% {
    transform: translateY(-5px);
  }
}

@keyframes borderGlow {
  0%, 100% {
    box-shadow: 0 0 10px rgba(52, 152, 219, 0.5);
  }
  50% {
    box-shadow: 0 0 20px rgba(52, 152, 219, 0.8);
  }
}

@keyframes cornerGlow {
  0% {
    opacity: 0.3;
    transform: scale(1);
  }
  100% {
    opacity: 0.7;
    transform: scale(1.2);
  }
}

@keyframes floatIndicator {
  0%, 100% {
    transform: translateY(-50%) translateX(0);
  }
  50% {
    transform: translateY(-50%) translateX(-10px);
  }
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

@keyframes particleFloat {
  0% {
    transform: translateX(0) translateY(0) rotate(0deg);
  }
  33% {
    transform: translateX(-30px) translateY(-30px) rotate(120deg);
  }
  66% {
    transform: translateX(30px) translateY(30px) rotate(240deg);
  }
  100% {
    transform: translateX(0) translateY(0) rotate(360deg);
  }
}

// ===============================
// SCROLLBARS PERSONALIZADOS
// ===============================
::-webkit-scrollbar {
  width: 10px;
}

::-webkit-scrollbar-track {
  background: #2c2c2c;
  border-radius: 5px;
}

::-webkit-scrollbar-thumb {
  background: linear-gradient(180deg, #3498db, #2980b9);
  border-radius: 5px;
  border: 1px solid #2c2c2c;
  
  &:hover {
    background: linear-gradient(180deg, #5dade2, #3498db);
  }
}

// ===============================
// RESPONSIVE DESIGN AVANZADO
// ===============================
@media (max-width: 1600px) {
  .monitoring-grid-container {
    .main-panels-container {
      .left-panel {
        min-width: 380px;
        
        .control-section,
        .plan-section {
          padding: 12px;
        }
      }
      
      .right-panel-grid {
        .event-log-component {
          margin: 16px;
          padding: 16px;
        }
      }
    }
  }
}

@media (max-width: 1400px) {
  .monitoring-grid-container {
    .main-panels-container {
      grid-template-columns: 40% 1fr; // Ajustar proporción
      
      .left-panel {
        min-width: 350px;
      }
    }
    
    .welcome-banner {
      .welcome-content {
        .welcome-text {
          font-size: 12px;
        }
      }
    }
  }
}

@media (max-width: 1200px) {
  .monitoring-grid-container {
    .main-panels-container {
      grid-template-columns: 1fr; // Una sola columna
      grid-template-rows: 40% 60%; // Filas verticales
      
      .left-panel {
        width: 100%;
        min-width: unset;
        border-right: none;
        border-bottom: 3px solid #3498db;
        
        &::after {
          top: unset;
          bottom: 0;
          width: 100%;
          height: 3px;
          background: linear-gradient(90deg, #3498db, #2980b9, #3498db);
        }
        
        flex-direction: row;
        gap: 16px;
        
        .control-section {
          flex: 0 0 300px;
        }
        
        .plan-section {
          flex: 1;
        }
      }
      
      .right-panel-grid {
        width: 100%;
        height: 100%;
      }
    }
    
    .floating-indicators {
      bottom: 80px;
      right: 16px;
      top: unset;
      transform: none;
    }
  }
}

@media (max-width: 768px) {
  .monitoring-grid-container {
    .main-panels-container {
      grid-template-rows: 35% 65%; // Ajustar proporción para móvil
      
      .left-panel {
        flex-direction: column;
        padding: 12px;
        gap: 12px;
        
        .control-section {
          flex: 0 0 auto;
        }
        
        .plan-section {
          flex: 1;
          min-height: 200px;
        }
      }
      
      .right-panel-grid {
        .event-log-component {
          margin: 12px;
          padding: 12px;
        }
      }
    }
    
    .welcome-banner {
      left: 16px;
      right: 16px;
      transform: none;
      
      .welcome-content {
        .welcome-text {
          font-size: 11px;
        }
      }
    }
  }
}

// ===============================
// MODO ALTO CONTRASTE
// ===============================
@media (prefers-contrast: high) {
  .monitoring-grid-container {
    .main-panels-container {
      .left-panel {
        border-right-color: #ffffff;
        
        .control-section {
          border-color: #ffffff;
        }
        
        .plan-section {
          border-color: #ffffff;
        }
      }
      
      .right-panel-grid {
        .event-log-component {
          border-color: #ffffff;
        }
      }
    }
  }
}

// ===============================
// REDUCIR ANIMACIONES
// ===============================
@media (prefers-reduced-motion: reduce) {
  .monitoring-grid-container::before,
  .monitoring-grid-container::after,
  .welcome-banner,
  .floating-indicators .analysis-indicator,
  .left-panel::after {
    animation: none;
  }
  
  .left-panel .control-section,
  .left-panel .plan-section,
  .event-log-component {
    transition: none;
    
    &:hover {
      transform: none;
    }
  }
}
